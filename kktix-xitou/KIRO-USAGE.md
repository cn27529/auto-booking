# KKTIX 自動買票系統 - 使用說明

## 功能說明

自動搜尋並購買 KKTIX 上「員林→溪頭」的車票，支援單次執行或定時排程。

## 環境需求

- Node.js 14+
- 已安裝依賴套件：`puppeteer`, `node-cron`, `nodemailer`, `dotenv`

## 設定步驟

### 1. 設定環境變數

編輯 `.env` 檔案，確認以下設定：

```env
# KKTIX 帳號密碼
KKTIX_LOGIN=pc762827@gmail.com
KKTIX_PASSWORD=0978762827@

# Gmail 應用程式密碼 (用於發送通知郵件)
GMAIL_APP_PASSWORD=your_app_password_here
```

### 2. 執行程式

```bash
node kktix/kiro-booking.js
```

### 3. 選擇運行模式

程式啟動後會詢問：

```
請選擇運行模式:
1. 單次執行
2. 排程執行 (每 5 分鐘)
請輸入選擇 (1 或 2):
```

- **選 1**：執行一次後結束
- **選 2**：每 5 分鐘自動檢查一次，持續運行

## 執行流程

1. 🔍 搜尋「員林→溪頭」活動
2. ✅ 篩選狀態為「開賣中」的活動
3. 🎯 選擇第一個符合的活動
4. 🔐 自動登入 (如需要)
5. 🎫 選擇 1 張票
6. ☑️  勾選同意服務條款
7. ➡️  點擊「下一步」
8. ⏳ **暫停等待人工完成 reCAPTCHA 驗證**
9. ☑️  勾選「公開顯示參加資訊」
10. ✅ 點擊「確認表單資料」
11. 🎉 完成購票

## 重要提醒

### reCAPTCHA 人機驗證

- 程式會在遇到 reCAPTCHA 時**自動暫停**
- 請在瀏覽器視窗中**手動完成**圖片驗證
- 完成後程式會自動繼續執行

### 瀏覽器視窗

- 程式會開啟瀏覽器視窗 (非無頭模式)
- 可以看到整個購票過程
- 完成後瀏覽器會保持開啟，方便確認結果
- 按 `Ctrl+C` 可結束程序

### 郵件通知

- 購票成功或失敗都會發送郵件通知
- 收件地址：`cn27529@gmail.com`
- 需要正確設定 `GMAIL_APP_PASSWORD`

## 設定調整

如需修改設定，編輯 `kktix/kiro-booking.js` 中的 `config` 物件：

```javascript
this.config = {
  searchUrl: "...",           // 搜尋頁面網址
  keyword: "員林→溪頭",        // 搜尋關鍵字
  sendMailTo: "...",          // 收件信箱
  mailSubject: "...",         // 郵件主旨
  mailFrom: "...",            // 寄件信箱
};
```

## 常見問題

### Q: 找不到符合條件的活動？
A: 確認搜尋頁面有「員林→溪頭」且狀態為「開賣中」的活動。

### Q: 登入失敗？
A: 檢查 `.env` 中的 `KKTIX_LOGIN` 和 `KKTIX_PASSWORD` 是否正確。

### Q: 沒收到郵件通知？
A: 確認 `GMAIL_APP_PASSWORD` 已正確設定。

### Q: 如何停止排程模式？
A: 按 `Ctrl+C` 結束程序。

## 注意事項

- 請確保網路連線穩定
- 排程模式會持續運行，建議使用 PM2 管理
- 人機驗證需要手動完成，無法完全自動化
- 請遵守 KKTIX 使用條款，避免過度頻繁請求

## 技術支援

如有問題請檢查：
1. Node.js 版本是否符合需求
2. 依賴套件是否正確安裝
3. `.env` 設定是否完整
4. 網路連線是否正常
